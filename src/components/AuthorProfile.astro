---
import { formatDate, trimString } from '../lib/utils.js'
import siteMetadata from '../data/siteMetadata.js'

const { author, Content, posts = [] } = Astro.props
const locale = siteMetadata.locale ?? 'en-US'

function socialLinks(entry) {
  return [
    { label: 'X', href: entry.twitter },
    { label: 'GitHub', href: entry.github },
    { label: 'LinkedIn', href: entry.linkedin },
    { label: 'Stack Overflow', href: entry.stackoverflow },
    { label: 'Website', href: entry.url },
  ].filter((link) => Boolean(link.href))
}
---

<section class="border-b border-[#dde0ea] pb-12 pt-16 dark:border-[#222222] max-sm:pb-8 max-sm:pt-10">
  <div class="overflow-hidden rounded-md border border-[#d9dbe6] bg-white dark:border-[#222222] dark:bg-[#111111]">
    <div class="px-6 py-6 max-sm:px-4 max-sm:py-4">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div class="flex items-center gap-4">
          {author.avatar && (
            <img
              src={typeof author.avatar === 'string' ? author.avatar : author.avatar.src}
              alt={`${author.name} avatar`}
              width="72"
              height="72"
              class="h-18 w-18 rounded-full border border-[#d9dbe6] object-cover dark:border-[#222222]"
            />
          )}
          <div>
            <h1 class="text-sm font-semibold text-[#1f2430] dark:text-[#e0e0e0]">{author.name}</h1>
            {author.occupation && <p class="text-xs text-[#5b6270] dark:text-[#8a8a8a]">{author.occupation}</p>}
            <p class="text-xs text-gray-400 dark:text-gray-500">
              {posts.length} {posts.length === 1 ? 'post' : 'posts'}
            </p>
          </div>
        </div>

        {socialLinks(author).length > 0 && (
          <div class="flex flex-wrap items-center gap-3 text-xs">
            {
              socialLinks(author).map((link) => (
                <a
                  href={link.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="rounded border border-[#d9dbe6] bg-white px-2.5 py-1 text-[#5b6270] no-underline transition-colors hover:border-[#6a5fc1] hover:text-[#6a5fc1] dark:border-[#222222] dark:bg-[#111111] dark:text-[#8a8a8a] dark:hover:border-[#6a5fc1] dark:hover:text-[#d0ccff]"
                >
                  {link.label}
                </a>
              ))
            }
          </div>
        )}
      </div>
    </div>
  </div>
</section>

<section class="py-12">
  <article class="mb-10 rounded border border-[#d9dbe6] bg-white px-6 py-5 dark:border-[#222222] dark:bg-[#111111] max-sm:px-[1.15rem] max-sm:py-4">
    <h2 class="mb-4 text-xs font-normal uppercase tracking-widest text-gray-400 dark:text-gray-500">
      <span class="text-[#6a5fc1]">#</span> about
    </h2>
    <div class="prose prose-sm max-w-none dark:prose-invert">
      <Content />
    </div>
  </article>

  <div class="mb-8 flex items-center justify-between">
    <h2 class="text-xs font-normal uppercase tracking-widest text-gray-400 dark:text-gray-500">
      <span class="text-[#6a5fc1]">#</span> posts
    </h2>
    <span class="text-xs text-gray-400 dark:text-gray-500">
      {posts.length} {posts.length === 1 ? 'post' : 'posts'}
    </span>
  </div>

  <div class="flex flex-col gap-px">
    {posts.length === 0 && <p class="text-sm text-[#5b6270] dark:text-[#8a8a8a]">No posts found.</p>}
    {
      posts.map((post) => (
        <a
          href={`/blog/${post.slug}`}
          class="group mb-3 block cursor-pointer rounded border border-[#d9dbe6] bg-white px-6 py-5 text-inherit no-underline transition-colors hover:border-[#c4c9d8] hover:bg-[rgba(106,95,193,0.08)] dark:border-[#222222] dark:bg-[#111111] dark:hover:border-[#333333] dark:hover:bg-[rgba(106,95,193,0.12)] max-sm:px-[1.15rem] max-sm:py-4"
          aria-label={`Read "${post.title}"`}
        >
          <div class="mb-3 block">
            <span class="text-sm font-medium leading-[1.7] text-[#1f2430] transition-colors group-hover:text-[#6a5fc1] dark:text-[#e0e0e0] max-sm:text-xs">
              {post.title}
            </span>
          </div>
          <div class="mb-0.5 flex flex-wrap items-center gap-x-5 gap-y-1 text-xs text-gray-400 dark:text-gray-500 max-sm:flex-col max-sm:items-start max-sm:gap-y-1">
            <span class="flex items-center gap-1.5">
              <span class="text-gray-400 dark:text-gray-500">date:</span>
              <span class="text-[#5b6270] dark:text-[#8a8a8a]">
                <time datetime={post.date}>{formatDate(post.date, locale)}</time>
              </span>
            </span>
          </div>
          {post.summary && (
            <p class="mt-2 text-sm text-[#5b6270] dark:text-[#8a8a8a]">{trimString(post.summary, 220)}</p>
          )}
        </a>
      ))
    }
  </div>
</section>
